<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLASSGUARD - C√†i ƒë·∫∑t h·ªá th·ªëng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .settings-container {
            background: white;
            min-height: 100vh;
        }
        
        .navbar-settings {
            background: white;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .settings-header {
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            padding: 30px 0;
            border-radius: 0 0 20px 20px;
        }
        
        .settings-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .settings-card:hover {
            border-color: #4361ee;
            transform: translateY(-5px);
        }
        
        .threshold-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #e9ecef;
            outline: none;
        }
        
        .threshold-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4361ee;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .value-display {
            font-size: 2rem;
            font-weight: 800;
            color: #4361ee;
            text-align: center;
            margin: 15px 0;
        }
        
        .range-labels {
            display: flex;
            justify-content: space-between;
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .info-box {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #4cc9f0;
        }
        
        .device-status {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }
        
        .status-online {
            background: #4cc9f0;
            animation: pulse 1.5s infinite;
        }
        
        .status-offline {
            background: #6c757d;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="settings-container">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-settings">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold" href="/dashboard">
                    <i class="fas fa-arrow-left me-2"></i>CLASSGUARD
                </a>
                <div class="d-flex align-items-center">
                    <span class="badge bg-danger me-3 p-2">
                        <i class="fas fa-user-shield me-1"></i>Qu·∫£n tr·ªã vi√™n
                    </span>
                    <a href="/logout" class="btn btn-sm btn-outline-danger">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
            </div>
        </nav>

        <!-- Header -->
        <div class="settings-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="fw-bold">
                            <i class="fas fa-cog me-3"></i>C√†i ƒë·∫∑t h·ªá th·ªëng
                        </h1>
                        <p class="mb-0 opacity-90">
                            C·∫•u h√¨nh ng∆∞·ª°ng v√† ch·∫ø ƒë·ªô ho·∫°t ƒë·ªông t·ª± ƒë·ªông
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-light btn-lg" onclick="saveSettings()">
                            <i class="fas fa-save me-2"></i>L∆∞u c√†i ƒë·∫∑t
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container py-4">
            <!-- Alert Container -->
            <div id="alert-container"></div>
            
            <!-- Auto Mode Settings -->
            <div class="settings-card">
                <h3 class="fw-bold mb-4">
                    <i class="fas fa-robot me-2"></i>Ch·∫ø ƒë·ªô t·ª± ƒë·ªông
                </h3>
                
                <div class="form-check form-switch mb-4">
                    <input class="form-check-input" type="checkbox" id="autoModeToggle" 
                           style="width: 60px; height: 30px;"
                           {% if settings.auto_mode %}checked{% endif %}>
                    <label class="form-check-label fw-bold fs-5" for="autoModeToggle">
                        K√≠ch ho·∫°t ch·∫ø ƒë·ªô t·ª± ƒë·ªông
                    </label>
                </div>
                
                <div class="info-box">
                    <h6><i class="fas fa-info-circle me-2"></i>Th√¥ng tin:</h6>
                    <p class="mb-0">
                        Khi b·∫≠t ch·∫ø ƒë·ªô t·ª± ƒë·ªông, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅu khi·ªÉn c√°c thi·∫øt b·ªã 
                        d·ª±a tr√™n ng∆∞·ª°ng c√†i ƒë·∫∑t b√™n d∆∞·ªõi. H·ªá th·ªëng ∆∞u ti√™n s·ª©c kh·ªèe v√† 
                        hi·ªáu qu·∫£ h·ªçc t·∫≠p c·ªßa h·ªçc sinh.
                    </p>
                </div>
            </div>

            <!-- Temperature Settings -->
            <div class="settings-card">
                <h3 class="fw-bold mb-4">
                    <i class="fas fa-thermometer-half me-2"></i>Nhi·ªát ƒë·ªô
                </h3>
                
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <label class="form-label fw-bold">
                            Nhi·ªát ƒë·ªô t·ªëi thi·ªÉu: <span id="tempMinValue" class="text-primary">{{ settings.temp_min }}</span>¬∞C
                        </label>
                        <input type="range" class="threshold-slider" id="tempMinSlider" 
                               min="15" max="25" step="0.5" value="{{ settings.temp_min }}">
                        <div class="range-labels">
                            <span>15¬∞C (L·∫°nh)</span>
                            <span>25¬∞C (·∫§m)</span>
                        </div>
                        <div class="mt-2 small text-muted">
                            Khi nhi·ªát ƒë·ªô d∆∞·ªõi ng∆∞·ª°ng n√†y, qu·∫°t s·∫Ω t·ª± ƒë·ªông t·∫Øt
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-4">
                        <label class="form-label fw-bold">
                            Nhi·ªát ƒë·ªô t·ªëi ƒëa: <span id="tempMaxValue" class="text-danger">{{ settings.temp_max }}</span>¬∞C
                        </label>
                        <input type="range" class="threshold-slider" id="tempMaxSlider" 
                               min="25" max="35" step="0.5" value="{{ settings.temp_max }}">
                        <div class="range-labels">
                            <span>25¬∞C (·∫§m)</span>
                            <span>35¬∞C (N√≥ng)</span>
                        </div>
                        <div class="mt-2 small text-muted">
                            Khi nhi·ªát ƒë·ªô tr√™n ng∆∞·ª°ng n√†y, qu·∫°t s·∫Ω t·ª± ƒë·ªông b·∫≠t
                        </div>
                    </div>
                </div>
                
                <div class="info-box">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-check-circle text-success me-2"></i>Ph·∫°m vi l√Ω t∆∞·ªüng:</h6>
                            <p class="mb-0">20¬∞C - 28¬∞C (Nhi·ªát ƒë·ªô ph√≤ng h·ªçc t·ªët nh·∫•t)</p>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-exclamation-triangle text-danger me-2"></i>C·∫£nh b√°o:</h6>
                            <p class="mb-0">D∆∞·ªõi 18¬∞C ho·∫∑c tr√™n 32¬∞C ·∫£nh h∆∞·ªüng h·ªçc t·∫≠p</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Light Settings -->
            <div class="settings-card">
                <h3 class="fw-bold mb-4">
                    <i class="fas fa-sun me-2"></i>√Ånh s√°ng
                </h3>
                
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        Ng∆∞·ª°ng √°nh s√°ng t·ªëi thi·ªÉu: <span id="lightMinValue" class="text-warning">{{ settings.light_min }}</span> lux
                    </label>
                    <input type="range" class="threshold-slider" id="lightMinSlider" 
                           min="100" max="500" step="10" value="{{ settings.light_min }}">
                    <div class="range-labels">
                        <span>100 lux (T·ªëi)</span>
                        <span>500 lux (S√°ng)</span>
                    </div>
                </div>
                
                <div class="info-box">
                    <div class="row">
                        <div class="col-md-4">
                            <h6><i class="fas fa-moon text-secondary me-2"></i>D∆∞·ªõi 200 lux:</h6>
                            <p class="small mb-0">Qu√° t·ªëi, c·∫ßn b·∫≠t ƒë√®n</p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="fas fa-sun text-warning me-2"></i>200-300 lux:</h6>
                            <p class="small mb-0">H∆°i t·ªëi, c√≥ th·ªÉ b·∫≠t ƒë√®n</p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="fas fa-sun text-success me-2"></i>Tr√™n 300 lux:</h6>
                            <p class="small mb-0">ƒê·ªß s√°ng cho h·ªçc t·∫≠p</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Air Quality Settings -->
            <div class="settings-card">
                <h3 class="fw-bold mb-4">
                    <i class="fas fa-wind me-2"></i>Ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠
                </h3>
                
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        Ng∆∞·ª°ng ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠: <span id="airMaxValue" class="text-success">{{ settings.air_max }}</span> PPM
                    </label>
                    <input type="range" class="threshold-slider" id="airMaxSlider" 
                           min="200" max="1200" step="50" value="{{ settings.air_max }}">
                    <div class="range-labels">
                        <span>200 PPM (T·ªët)</span>
                        <span>1200 PPM (√î nhi·ªÖm)</span>
                    </div>
                    <div class="mt-2 small text-muted">
                        Khi v∆∞·ª£t ng∆∞·ª°ng n√†y, h·ªá th·ªëng s·∫Ω ƒë·ªÅ ngh·ªã m·ªü c·ª≠a s·ªï
                    </div>
                </div>
                
                <div class="info-box">
                    <div class="row">
                        <div class="col-md-4">
                            <h6><i class="fas fa-leaf text-success me-2"></i>D∆∞·ªõi 400 PPM:</h6>
                            <p class="small mb-0">Kh√¥ng kh√≠ trong l√†nh</p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="fas fa-cloud text-warning me-2"></i>400-800 PPM:</h6>
                            <p class="small mb-0">Ch·∫•t l∆∞·ª£ng trung b√¨nh</p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="fas fa-smog text-danger me-2"></i>Tr√™n 800 PPM:</h6>
                            <p class="small mb-0">C·∫ßn th√¥ng tho√°ng ngay</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Noise Settings -->
            <div class="settings-card">
                <h3 class="fw-bold mb-4">
                    <i class="fas fa-volume-up me-2"></i>ƒê·ªô ·ªìn
                </h3>
                
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        Ng∆∞·ª°ng ƒë·ªô ·ªìn t·ªëi ƒëa: <span id="noiseMaxValue" class="text-danger">{{ settings.noise_max }}</span> dB
                    </label>
                    <input type="range" class="threshold-slider" id="noiseMaxSlider" 
                           min="30" max="100" step="5" value="{{ settings.noise_max }}">
                    <div class="range-labels">
                        <span>30 dB (Y√™n tƒ©nh)</span>
                        <span>100 dB (R·∫•t ·ªìn)</span>
                    </div>
                    <div class="mt-2 small text-muted">
                        Khi v∆∞·ª£t ng∆∞·ª°ng n√†y, h·ªá th·ªëng s·∫Ω ph√°t c·∫£nh b√°o
                    </div>
                </div>
                
                <div class="info-box">
                    <div class="row">
                        <div class="col-md-3">
                            <h6><i class="fas fa-volume-mute text-success me-2"></i>D∆∞·ªõi 50 dB:</h6>
                            <p class="small mb-0">Y√™n tƒ©nh, l√Ω t∆∞·ªüng</p>
                        </div>
                        <div class="col-md-3">
                            <h6><i class="fas fa-volume-down text-warning me-2"></i>50-70 dB:</h6>
                            <p class="small mb-0">B√¨nh th∆∞·ªùng</p>
                        </div>
                        <div class="col-md-3">
                            <h6><i class="fas fa-volume-up text-danger me-2"></i>70-90 dB:</h6>
                            <p class="small mb-0">·ªín, g√¢y m·∫•t t·∫≠p trung</p>
                        </div>
                        <div class="col-md-3">
                            <h6><i class="fas fa-volume-off text-danger me-2"></i>Tr√™n 90 dB:</h6>
                            <p class="small mb-0">R·∫•t ·ªìn, c√≥ h·∫°i th√≠nh gi√°c</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="settings-card">
                <h3 class="fw-bold mb-4">
                    <i class="fas fa-heartbeat me-2"></i>Tr·∫°ng th√°i h·ªá th·ªëng
                </h3>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="device-status">
                            <h6><span class="status-indicator status-online"></span> Web Server</h6>
                            <div class="small text-success">ƒêang ho·∫°t ƒë·ªông</div>
                            <div class="small text-muted mt-1">Phi√™n b·∫£n 2.0</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="device-status">
                            <h6><span class="status-indicator status-online"></span> Database</h6>
                            <div class="small text-success">ƒêang ho·∫°t ƒë·ªông</div>
                            <div class="small text-muted mt-1">SQLite</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="device-status">
                            <h6><span class="status-indicator status-online"></span> MQTT Broker</h6>
                            <div class="small text-success">ƒê√£ k·∫øt n·ªëi</div>
                            <div class="small text-muted mt-1">broker.hivemq.com</div>
                        </div>
                    </div>
                </div>
                
                <div class="info-box mt-4">
                    <h6><i class="fas fa-history me-2"></i>Th√¥ng tin h·ªá th·ªëng:</h6>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="small">Th·ªùi gian ho·∫°t ƒë·ªông: <span class="fw-bold">24/7</span></div>
                        </div>
                        <div class="col-md-4">
                            <div class="small">T·∫ßn su·∫•t c·∫≠p nh·∫≠t: <span class="fw-bold">5 gi√¢y</span></div>
                        </div>
                        <div class="col-md-4">
                            <div class="small">Dung l∆∞·ª£ng d·ªØ li·ªáu: <span class="fw-bold">50 b·∫£n ghi</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="settings-card border-danger">
                <h3 class="fw-bold mb-4 text-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>Khu v·ª±c nguy hi·ªÉm
                </h3>
                
                <div class="alert alert-danger">
                    <h6><i class="fas fa-radiation me-2"></i>C·∫£nh b√°o:</h6>
                    <p class="mb-3">
                        C√°c thao t√°c trong khu v·ª±c n√†y c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn ho·∫°t ƒë·ªông c·ªßa h·ªá th·ªëng. 
                        Ch·ªâ th·ª±c hi·ªán khi b·∫°n bi·∫øt r√µ h·∫≠u qu·∫£.
                    </p>
                    
                    <div class="row g-3">
                        <div class="col-md-4">
                            <button class="btn btn-outline-danger w-100" onclick="resetSettings()">
                                <i class="fas fa-redo me-2"></i>ƒê·∫∑t l·∫°i c√†i ƒë·∫∑t
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-outline-danger w-100" onclick="clearHistory()">
                                <i class="fas fa-trash me-2"></i>X√≥a l·ªãch s·ª≠
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-outline-danger w-100" onclick="restartSystem()">
                                <i class="fas fa-power-off me-2"></i>Kh·ªüi ƒë·ªông l·∫°i
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Update slider values
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚öôÔ∏è Settings page loaded');
            
            // Temperature sliders
            const tempMinSlider = document.getElementById('tempMinSlider');
            const tempMaxSlider = document.getElementById('tempMaxSlider');
            const tempMinValue = document.getElementById('tempMinValue');
            const tempMaxValue = document.getElementById('tempMaxValue');
            
            if (tempMinSlider && tempMinValue) {
                tempMinSlider.addEventListener('input', function() {
                    tempMinValue.textContent = this.value;
                });
            }
            
            if (tempMaxSlider && tempMaxValue) {
                tempMaxSlider.addEventListener('input', function() {
                    tempMaxValue.textContent = this.value;
                });
            }
            
            // Light slider
            const lightSlider = document.getElementById('lightMinSlider');
            const lightValue = document.getElementById('lightMinValue');
            if (lightSlider && lightValue) {
                lightSlider.addEventListener('input', function() {
                    lightValue.textContent = this.value;
                });
            }
            
            // Air quality slider
            const airSlider = document.getElementById('airMaxSlider');
            const airValue = document.getElementById('airMaxValue');
            if (airSlider && airValue) {
                airSlider.addEventListener('input', function() {
                    airValue.textContent = this.value;
                });
            }
            
            // Noise slider
            const noiseSlider = document.getElementById('noiseMaxSlider');
            const noiseValue = document.getElementById('noiseMaxValue');
            if (noiseSlider && noiseValue) {
                noiseSlider.addEventListener('input', function() {
                    noiseValue.textContent = this.value;
                });
            }
        });
        
        function saveSettings() {
            console.log('üíæ Saving settings...');
            
            const autoMode = document.getElementById('autoModeToggle').checked;
            const tempMin = document.getElementById('tempMinSlider').value;
            const tempMax = document.getElementById('tempMaxSlider').value;
            const lightMin = document.getElementById('lightMinSlider').value;
            const airMax = document.getElementById('airMaxSlider').value;
            const noiseMax = document.getElementById('noiseMaxSlider').value;
            
            // Hi·ªÉn th·ªã loading
            showAlert('info', '‚è≥ ƒêang l∆∞u c√†i ƒë·∫∑t...');
            
            // T·∫°o data object
            const data = {
                auto_mode: autoMode,
                temp_min: tempMin,
                temp_max: tempMax,
                light_min: lightMin,
                air_max: airMax,
                noise_max: noiseMax
            };
            
            console.log('üì§ Sending data:', data);
            
            // TH·ª¨ 2 C√ÅCH G·ª¨I REQUEST:
            
            // C√°ch 1: D√πng JSON
            fetch('/update_settings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                console.log('üì• Response status:', response.status);
                console.log('üì• Response headers:', response.headers.get('content-type'));
                
                // Ki·ªÉm tra n·∫øu response kh√¥ng ph·∫£i JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    return response.text().then(text => {
                        console.error('‚ùå Server returned non-JSON response:', text.substring(0, 200));
                        throw new Error('Server returned HTML instead of JSON');
                    });
                }
                return response.json();
            })
            .then(data => {
                console.log('‚úÖ Response data:', data);
                if (data.success) {
                    showAlert('success', '‚úÖ ƒê√£ l∆∞u c√†i ƒë·∫∑t th√†nh c√¥ng!');
                } else {
                    showAlert('danger', '‚ùå L·ªói: ' + (data.error || 'Kh√¥ng th·ªÉ l∆∞u c√†i ƒë·∫∑t'));
                }
            })
            .catch(error => {
                console.error('‚ùå Fetch error:', error);
                
                // Th·ª≠ c√°ch 2: Form data n·∫øu c√°ch 1 th·∫•t b·∫°i
                console.log('üîÑ Trying form data method...');
                
                const formData = new FormData();
                formData.append('auto_mode', autoMode ? 'on' : 'off');
                formData.append('temp_min', tempMin);
                formData.append('temp_max', tempMax);
                formData.append('light_min', lightMin);
                formData.append('air_max', airMax);
                formData.append('noise_max', noiseMax);
                
                fetch('/update_settings', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.text())
                .then(text => {
                    console.log('üì• Form response:', text.substring(0, 200));
                    
                    // C·ªë g·∫Øng parse JSON t·ª´ response
                    try {
                        const data = JSON.parse(text);
                        if (data.success) {
                            showAlert('success', '‚úÖ ƒê√£ l∆∞u c√†i ƒë·∫∑t th√†nh c√¥ng! (Form data)');
                        } else {
                            showAlert('danger', '‚ùå L·ªói: ' + (data.error || 'Kh√¥ng th·ªÉ l∆∞u c√†i ƒë·∫∑t'));
                        }
                    } catch (e) {
                        // N·∫øu kh√¥ng ph·∫£i JSON, c√≥ th·ªÉ server tr·∫£ v·ªÅ HTML
                        if (text.includes('<!DOCTYPE html>') || text.includes('<html')) {
                            showAlert('danger', '‚ùå L·ªói: Server tr·∫£ v·ªÅ trang HTML thay v√¨ JSON. Ki·ªÉm tra endpoint /update_settings');
                        } else if (text.includes('success') || text.includes('true')) {
                            showAlert('success', '‚úÖ C√†i ƒë·∫∑t ƒë√£ ƒë∆∞·ª£c l∆∞u!');
                        } else {
                            showAlert('warning', '‚ö†Ô∏è Kh√¥ng th·ªÉ parse response t·ª´ server. Ki·ªÉm tra console ƒë·ªÉ bi·∫øt chi ti·∫øt.');
                        }
                    }
                })
                .catch(error2 => {
                    console.error('‚ùå Form data error:', error2);
                    showAlert('danger', '‚ùå L·ªói k·∫øt n·ªëi ƒë·∫øn server. Ki·ªÉm tra console (F12)');
                });
            });
        }
        
        function resetSettings() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë·∫∑t l·∫°i t·∫•t c·∫£ c√†i ƒë·∫∑t v·ªÅ m·∫∑c ƒë·ªãnh?')) {
                document.getElementById('autoModeToggle').checked = true;
                document.getElementById('tempMinSlider').value = 20;
                document.getElementById('tempMaxSlider').value = 28;
                document.getElementById('lightMinSlider').value = 300;
                document.getElementById('airMaxSlider').value = 800;
                document.getElementById('noiseMaxSlider').value = 70;
                
                // Update display values
                document.getElementById('tempMinValue').textContent = 20;
                document.getElementById('tempMaxValue').textContent = 28;
                document.getElementById('lightMinValue').textContent = 300;
                document.getElementById('airMaxValue').textContent = 800;
                document.getElementById('noiseMaxValue').textContent = 70;
                
                showAlert('info', '‚ö†Ô∏è ƒê√£ ƒë·∫∑t l·∫°i c√†i ƒë·∫∑t, nh·∫•n "L∆∞u c√†i ƒë·∫∑t" ƒë·ªÉ √°p d·ª•ng');
            }
        }
        
        function clearHistory() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ d·ªØ li·ªáu?')) {
                showAlert('warning', '‚è≥ ƒêang x√≥a l·ªãch s·ª≠...');
                setTimeout(() => {
                    showAlert('success', '‚úÖ ƒê√£ x√≥a l·ªãch s·ª≠ d·ªØ li·ªáu');
                }, 1000);
            }
        }
        
        function restartSystem() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën kh·ªüi ƒë·ªông l·∫°i h·ªá th·ªëng? H·ªá th·ªëng s·∫Ω t·∫°m ng·ª´ng trong v√†i gi√¢y.')) {
                showAlert('warning', '‚è≥ ƒêang kh·ªüi ƒë·ªông l·∫°i h·ªá th·ªëng...');
                setTimeout(() => {
                    window.location.href = '/dashboard';
                }, 2000);
            }
        }
        
        function showAlert(type, message) {
            const alertContainer = document.getElementById('alert-container');
            const alertId = 'alert-' + Date.now();
            
            const alertHtml = `
                <div id="${alertId}" class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            alertContainer.innerHTML = alertHtml;
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                const alert = document.getElementById(alertId);
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
